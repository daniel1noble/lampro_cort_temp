---
title: "Methods and Results"
author: Ondi, Dalton, Pablo, Dan
date: "`r Sys.Date()`"
bibliography: ./bib/refs.bib
csl: ./bib/the-journal-of-experimental-biology.csl
output: 
  bookdown::html_document2:
    code_folding: hide
    number_sections: no
    toc: yes
    toc_depth: 6
    toc_float: yes
  bookdown::word_document2:
    toc: no
    toc_depth: 6
    number_sections: false
    reference_docx: template.docx
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = FALSE, tidy = TRUE)
options(digits=2)
```


#### R Chunks where code can go

Chunks have a unique identifier. In this case "loadpackages". Make sure these are ALL unique. `echo` tells you that you want the code to be rendered. Change this to FALSE and it will 'hide' the code. results = 'hide' indicates that any object with stored information is not printed but hidden. messages = FALSE indicates that you do not want any warning messages printed. For the purpose of rendering, thats the best option. 

```{r loadpackages, echo = TRUE, results = "hide", messages = FALSE}
#install.packages("pacman")
#devtools::install_github("itchyshin/orchard_plot", subdir = "orchaRd", force = TRUE)
#devtools::install_github("daniel1noble/metaAidR")
pacman::p_load(devtools, png, jpeg, pander, cowplot, flextable, formatR, magick,
               tidyverse, metafor, orchaRd, here, osfr, magrittr, metaAidR, equatags)
```

Here's an example with some modelling code:

```{r, models, eval = FALSE, echo = TRUE, results = "hide", messages = FALSE}

# Multi-level meta-analytic model
model_CS1a_MLMA <- metafor::rma.mv(ARR ~ 1, V = Var_ARR, 
                   method="REML",
                   random=list(~1|species_ID,
                               ~1|es_ID), 
                   test="t",
                   data=data_CS1a)
print(model_CS1a_MLMA)
B <- coef(model_CS1a_MLMA)
# Calculate Prediction Intervals
PI_CS1a_MLMA <- predict(model_CS1a_MLMA)
print(PI_CS1a_MLMA)

# Calculate I2
I2_CS1a <- orchaRd::i2_ml(model_CS1a_MLMA)
print(I2_CS1a)

# Plot the results
orchard_plot(model_CS1a_MLMA, mod="Int", xlab="ARR")
```


#### Figures and Tables
Make sure you load the `flextable` package. This is the best table package out there! I've already added it to the `p_load` function in the first code chunk. If you want to have a table or figure you can do this quite easily as follows

```{r, fig1, fig.cap="A detailed description of text associated with figure."}
plot(rnorm(10, 0, 1) ~ rnorm(10, 0, 1), ylab = "y", xlab = "x")
```

Here, Figure \@ref(fig:fig1) is just a random smash of points. You can plot whatever you want and could even just have a seperate figure that you bring in and plot within the code chunk. You do the same thing with a table, but reference things differently. For example, if we see Table \@ref(tab:tab1) below:

```{r, tab1, tab.cap="A detailed description of text associated with table."}
tab_dat <- data.frame(col1 = 3, col2= 23, col3 = 86)
flextable(tab_dat)
```

Flextable is amazing. Have a good read of the documentation [here](https://ardata-fr.github.io/flextable-book/) if you need it as LOTS can be modified. 

#### Equations
I use this alot. There are inline ( for example $\beta_{2}$, or $\frac{SD}{\hat{X}}$) AND normal euqations that can be labelled. You just use laTeX within Rmd as follows. If you're not sure how to build a lateX equation, have a look [here](https://latexeditor.lagrida.com), which allows you to see the code to build specific equation elements. Also, just a good old Google is all you need most of the time.


$$
\text{ARR} = \frac{M_{1} - M_{2}}{T_2 - T_1},
$$


# References