---
title: "Methods and Results"
author: Ondi, Dalton, Pablo, Dan
date: "`r Sys.Date()`"
bibliography: ./bib/refs.bib
csl: ./bib/the-journal-of-experimental-biology.csl
output: 
  bookdown::html_document2:
    code_folding: hide
    number_sections: no
    toc: yes
    toc_depth: 6
    toc_float: yes
  bookdown::word_document2:
    toc: no
    toc_depth: 6
    number_sections: false
    reference_docx: template.docx
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = FALSE, tidy = TRUE)
options(digits=2)
```

#### R Chunks where code can go

Chunks have a unique identifier. In this case "loadpackages". Make sure these are ALL unique. `echo` tells you that you want the code to be rendered. Change this to FALSE and it will 'hide' the code. results = 'hide' indicates that any object with stored information is not printed but hidden. messages = FALSE indicates that you do not want any warning messages printed. For the purpose of rendering, thats the best option.

```{r loadpackages, echo = TRUE, results = "hide", messages = FALSE}
#install.packages("pacman")
#devtools::install_github("itchyshin/orchard_plot", subdir = "orchaRd", force = TRUE)
#devtools::install_github("daniel1noble/metaAidR")
pacman::p_load(devtools, png, jpeg, pander, cowplot, flextable, formatR, magick,
               tidyverse, metafor, orchaRd, here, osfr, magrittr, metaAidR, equatags)
```

Here's an example with some modelling code:

```{r, models, eval = FALSE, echo = TRUE, results = "hide", messages = FALSE}

# Multi-level meta-analytic model
model_CS1a_MLMA <- metafor::rma.mv(ARR ~ 1, V = Var_ARR, 
                   method="REML",
                   random=list(~1|species_ID,
                               ~1|es_ID), 
                   test="t",
                   data=data_CS1a)
print(model_CS1a_MLMA)
B <- coef(model_CS1a_MLMA)
# Calculate Prediction Intervals
PI_CS1a_MLMA <- predict(model_CS1a_MLMA)
print(PI_CS1a_MLMA)

# Calculate I2
I2_CS1a <- orchaRd::i2_ml(model_CS1a_MLMA)
print(I2_CS1a)

# Plot the results
orchard_plot(model_CS1a_MLMA, mod="Int", xlab="ARR")
```

#### Figures and Tables

Make sure you load the `flextable` package. This is the best table package out there! I've already added it to the `p_load` function in the first code chunk. If you want to have a table or figure you can do this quite easily as follows

```{r, fig1, warning=FALSE, fig.cap="A detailed description of text associated with figure."}
plot(rnorm(10, 0, 1) ~ rnorm(10, 0, 1), ylab = "y", xlab = "x")
```

Here, Figure \@ref(fig:fig1) is just a random smash of points. You can plot whatever you want and could even just have a separate figure that you bring in and plot within the code chunk. You do the same thing with a table, but reference things differently. For example, if we see Table \@ref(tab:tab1) below:

```{r, tab1, tab.cap="A detailed description of text associated with table."}
tab_dat <- data.frame(col1 = 3, col2= 23, col3 = 86)
flextable(tab_dat)
```

Flextable is amazing. Have a good read of the documentation [here](https://ardata-fr.github.io/flextable-book/) if you need it as LOTS can be modified.

#### Adjusting the look of Table and Figure Legends

This can be done! It's not quite as easy as it should be but to do this you just need to adjust a special type of file for bookdown called `_bookdown_yaml`, which I have added here but not modified. I can show you more if you need to see how that works.

#### Equations

I use this a lot. There are inline ( for example $\beta_{2}$, or $\frac{SD}{\hat{X}}$) AND normal equations that can be labelled. You just use *LaTeX* within Rmd as follows. If you're not sure how to build a *LaTeX* equation, have a look [here](https://latexeditor.lagrida.com), which allows you to see the code to build specific equation elements. Also, just a good old Google is all you need most of the time.

$$
\begin{equation} 
lnVR_{Q_{10}} = ln\left( \frac{SD_{2}}{SD_{1}} \right){ \left(\ \frac{10^{\circ}C}{T_{2}-T_{1}} \right) }
(\#eq:lnq10VR)
\end{equation} 
$$ Rendering numbered equations in word is really the only limitation at the moment because equation numbers don't seem to properly get setup for the outline equations. However, the order IS correct in the text that you are righting, so you just need to manually add in equation numbers but they are all in numerical order anyway.

#### Citing others!!

Ah yes....you might think you need Endnote, but you'd be wrong. It can all be done in Rmarkdown. The key change to what you're probably used to is that you need two files. One `bib` file that hols all the bibliographic information. In essence, this is a very much downsized version of Endnote. You can download [BibDesk](https://bibdesk.sourceforge.io), and use this instead of Endnote. Each citation has a "citekey" this is effectively how you cite papers.

So, if we need to cite a famous meta-analysis paper then we just use `@` in front of the cite key like: @Hedges1999. If you want this wrapped at the end of a sentence then you can list all the citations like [@Hedges1999; @Koricheva2013; @Higgins2002]. That's it. All the refs will get sorted our at the end after the last reference subtitle.

Now how do you control the style of refs? You use what's called a style file or '.csl' file for the specific journal you're interested in using. In this case, where using JEB (as indicated in the YAML header at the top). You can change that by just dropping in a new style file and adjusting the YAML header accordingly.

#### Conclusions

Now you're armed with everything that you need to write you papers. It's also now 100% reproducible because we can all track where every number us coming from. Because it's on GitHub and well documented its also now easy to just make the code and data available for review and in the final publication steps by (quite literally) clicking a single button.

One point here. Writing in Rstudio is not as "elegant" looking as Word, but it's much more flexible and it WILL not crash on you. However, a new function they have introduced to make writing a little prettier is in the top left corner. Beside `Source` you can click `Visual` and this will render the document nicely for you. You can also continue writing as normal.

I know it's a lot to take in, and it WILL be a little more work to get your head around some stuff, but as you start to use it more things will be easier and easier. It will ultimately end up saving you a TONNE of time down the road. Keep that in mind while you use it. Again, the only way you'll learn is to use it. 

#### References
